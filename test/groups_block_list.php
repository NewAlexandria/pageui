<?php /// User logins should be validated against a system login table, and the table should include a variable specific to the login cookie data: either a browser-generated cookie ID, or a seeded rand() saved as cookie var.  If it were hashed against the user password hash then its closer to a cryptographic login validation// setup the ORDER sufix to sort the SQL rowset.// setup, also, display vars and other user-controls (  $group_inv = '';  $URL_inv = '';  $link_inv = '';  $date_inv = '';  /// in the future we may get these from the $_SESSION.  Do huge sessions make for a slow connection??if ( ($_REQUEST['links_flat_list_sort']) or ( $_SESSION['links_flat_list_sort']) ) {		// set session variables to maintain the view	if ( $_REQUEST['links_flat_list_sort'] ) $_SESSION['links_flat_list_sort'] = $_REQUEST['links_flat_list_sort'];	if ( $_REQUEST['inv'] ) $_SESSION['inv'] = $_REQUEST['inv'];	$links_flat_list_sort = $_SESSION['links_flat_list_sort'];	$inv = $_SESSION['inv'];		switch ( $links_flat_list_sort )	{	    case "group":	        $order = ' ORDER BY G.Title ASC, G.row, G.col, L.col, L.row';	        if ( $inv == '1' ) {	        	$order = ' ORDER BY G.Title DESC, G.row, G.col, L.col, L.row';	        } else {	        	$group_inv = '&inv=1';	        }	        			$group_hl = ' class="sort-highlight"';	        break;	    case "date":	        $order = ' ORDER BY L.date_add';	        if ( $inv ) {	        	$order .= ' DESC';	        } else {	        	$date_inv = '&inv=1';	        }	        			$date_hl = ' class="sort-highlight"';	        break;	    case "title":	        $order = ' ORDER BY L.title';	        if ( $inv ) {	        	$order .= ' DESC';	        } else {	        	$link_inv = '&inv=1';	        }	        			$link_hl = ' class="sort-highlight"';	        break;	    case "URL":	        $order = ' ORDER BY L.URL';	        if ( $inv ) {	        	$order .= ' DESC';	        } else {	        	$URL_inv = '&inv=1';	        }	        			$URL_hl = ' class="sort-highlight"';	        break;	    default:	        $order = ' ORDER BY GP.row, GP.col, L.col, L.row';	        break;	}	} $sql = "SELECT L.col, L.row, G.Title AS GTitle, GP.row as grow, GP.col as gcol, G.id as gid, L.* FROM Links as L INNER JOIN Groups G ON L.group_id = G.id INNER JOIN Pages P ON L.page_id = P.id INNER JOIN GroupsPages as GP ON L.group_id = G.id WHERE (L.user_id = GP.user_id AND L.group_id = GP.group_id AND L.page_id = GP.page_id ) AND L.user_id = ".$_SESSION['user_id']." AND L.page_id = ".$_SESSION['page_id']." ORDER BY GP.row, GP.col, L.col, L.row";// echo $sql;$result = mysql_query($sql);$errtxt .= $sql;$errtxt .= '<br/>sql error: '.mysql_error($db).''; $errtxt .= '<br/>rows: '.mysql_num_rows($result).'<br/>'; // this is buit for the links tha re-organize the list of links$sort_url = $site_uri.substr($_SERVER['SCRIPT_NAME'], 1);// $_SERVER['SCRIPT_NAME']?>		<div><?php 		if (mysql_num_rows($result)>0) { 			$grow_last = 0;			$gcol_last = 0;			$lcol_last = 0;			$grow_close = '';			$gcol_close = '';			$lcol_close = '';									while ( $res = mysql_fetch_assoc($result) ) { 				$grow = $res['grow'];				$gcol = $res['gcol'];				$lcol = $res['col'];				$edit_link = $site_uri.$site_path.'edit.php?link_id='.$res['id']; 				if ( $grow_close != '') {					if ( $grow_last != $grow ) {						echo '</ul></td></tr></table>';					} else if ( $gcol_last != $gcol ) {						echo '</ul></td>';					} else if ( $lcol_last != $lcol ) {						echo '</ul>';					}				}								if ( $grow_last != $grow ) { 				// echo $grow_close; 				?>				<table style="width: 100%">				<tr>				<td class="group_block">					<div class="group_title"><?php echo $res['GTitle']?>					</div>					<ul><?php			} else if ( $gcol_last != $gcol ) { 				//echo $gcol_close; 				?>				<td class="group_block">					<div class="group_title"><?php echo $res['GTitle']?>					</div>					<ul>					<?php			} else if ( $lcol_last != $lcol ) { 				// echo $lcol_close; 				?>					<ul><?php			}				//	the link row will always change				?>									<li><a href="<?php echo $res['URL']?>" target="_blank"><?php echo $res['title']?></a></li><?php			if ( $lcol_last != $lcol ) { ?>				<?php			}				if ( $gcol_last != $gcol ) { ?>				<?php			}				if ( $grow_last != $grow ) { ?><?php			}							$grow_last = $grow;				$gcol_last = $gcol;				$lcol_last = $lcol;				$grow_close = '</ul></td></tr>';				$gcol_close = '</ul></td>';				$lcol_close = '</ul>';							} ?>			</ul></td></tr></table>			<?php	}	?>						</div>