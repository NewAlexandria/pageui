<?php session_start();require_once('config/keys.php');require_once('config/db.php');	/// User logins should be validated against a system login table, and the table should include a variable specific to the login cookie data: either a browser-generated cookie ID, or a seeded rand() saved as cookie var.  If it were hashed against the user password hash then its closer to a cryptographic login validationif ( $_REQUEST['s_page_id'] ) {	$page_id = $_REQUEST['s_page_id'];} else { 	$page_id = $_SESSION['page_id'];}$user_id = ReturnSecureString( $_SESSION['user_id'] );$sql = "SELECT L.col as lcol, L.row, G.Title AS GTitle, GP.row as grow, GP.col as gcol, G.id as gid, L.* FROM Groups G INNER JOIN GroupsPages as GP ON GP.group_id = G.id INNER JOIN Pages P ON GP.page_id = P.id LEFT OUTER JOIN Links as L ON (L.user_id = GP.user_id AND L.group_id = GP.group_id AND L.page_id = GP.page_id ) WHERE GP.user_id = ".$user_id." AND GP.page_id = ".$page_id." AND G.GroupType_id <> 2 ORDER BY GP.row, GP.col, L.col, L.row";// $sqlSys = "SELECT L.col as lcol, L.row, G.Title AS GTitle, ".$unsorted_row." as grow, 1 as gcol,  G.id as gid,  L.* FROM Links as L INNER JOIN Groups G ON L.group_id = G.id  WHERE L.user_id = ".$_SESSION['user_id']." AND G.GroupType_id = 2 ORDER BY grow, gcol, L.col, L.row";$sqlSys = "SELECT L.col as lcol, L.row, G.Title AS GTitle, GP.row as grow, GP.col as gcol, G.id as gid, L.* FROM Groups G INNER JOIN GroupsPages as GP ON GP.group_id = G.id LEFT OUTER JOIN Links as L ON (L.user_id = GP.user_id AND L.group_id = GP.group_id AND L.page_id = GP.page_id ) WHERE GP.user_id = ".$user_id." AND G.GroupType_id = 2 ORDER BY GP.row, GP.col, L.col, L.row";// echo $sql;$result = mysql_query($sql);$errtxt .= '<br/>'.$sql;$errtxt .= '<br/>sql error: '.mysql_error($db).''; $errtxt .= '<br/>rows: '.mysql_num_rows($result).'<br/>'; $resultSys = mysql_query($sqlSys);$errtxt .= '<br/>'.$sqlSys;$errtxt .= '<br/>sql error: '.mysql_error($db).''; $errtxt .= '<br/>rows: '.mysql_num_rows($resultSys).'<br/>'; // this is buit for the links tha re-organize the list of links$sort_url = $site_uri.substr($_SERVER['SCRIPT_NAME'], 1);// $_SERVER['SCRIPT_NAME']?>		<div class="group_set"><?php $grow_last = 0;$AJAX_group_sortables = '';$AJAX_group_sortable_connections = '';$AJAX_link_sortables = '';$AJAX_link_sortable_connections = '';$AJAX_group_originals = "";// the whole group printing is wrapped in a function so that we can call it for regular groups and sys groups.  There probably exists a fancy enough SQL statement to do it all in 1 SQL call.function PrintGroups($result, $sys = 0) {	global $errtxt;	global $grow_last;	global $AJAX_group_sortables;	global $AJAX_group_sortable_connections;	global $AJAX_link_sortables;	global $AJAX_link_sortable_connections;	global $AJAX_group_originals;			if (mysql_num_rows($result)>0) { 			// $grow_last = 0;  // we set $grow_last outside this proc to maintain group consistency across procedure calls			$gcol_last = 0;			$lcol_last = 0;			$grow_close = '';			$gcol_close = '';			$lcol_close = '';			$gid_last = '';						//	these 4 strings allow the DB while loop to build the list of groups and links that need to be activated via jQuery//			$AJAX_group_sortables = '';//			$AJAX_group_sortable_connections = '';//			$AJAX_link_sortables = '';//			$AJAX_link_sortable_connections = '';//			$AJAX_group_originals = "";						if ( ($AJAX_group_sortables == '') && ($sys == 0) ) {				echo '				<table class="group_row_new" id="groupsRow_'.('n'.$grow_last).'"><tr><td></td></tr></table>'.$crlf; 				$AJAX_group_sortables .= '$("#groupsRow_'.('n'.$grow_last).'").sortable({ %%%, dropOnEmpty: true, update: function(element, ui) { updateGroupSort ("#groupsRow_'.('n'.$grow_last).'", "'.('n'.$grow_last).'"); }, start: function(e, ui) { groupsSortStart(); }, stop: function(e, ui) { groupsSortStop(); }, over: function(e, ui) { groupsSortOver( e, ui); }, change: function(e, ui) { groupsSortChange( e, ui); }, receive: function(e, ui) { groupsSortReceive( e, ui); } });'.$crlf; 				$AJAX_group_sortable_connections .= ', "#groupsRow_'.('n'.$grow_last).'"';			}							while ( $res = mysql_fetch_assoc($result) ) { 				$grow = $res['grow'];				$gcol = $res['gcol'];				$lcol = $res['lcol'];								// this catches -1 lcol values when a group contains no links				if ($lcol == '' ) $lcol = '1';								$edit_link = $site_uri.$site_path.'edit.php?link_id='.$res['id']; 				if ( $grow_close != '') {  // set to a value at the end of each loop.  ensures that the LIs and ULs aren't closed on the first loop.					if ( $grow_last != $grow ) {						echo '				</td><td class="link_col_t" id="links_g'.$gid_last.'c'.($lcol_last+1).'">&nbsp;</td></tr></table></td></tr></table>'.$crlf;						echo '			<table class="group_row_new" id="groupsRow_'.('n'.$grow_last).'"><tr><td></td></tr></table>'.$crlf; 												$AJAX_group_sortables .= '$("#groupsRow_'.('n'.$grow_last).'").sortable({ %%%, dropOnEmpty: true, update: function(element, ui) { updateGroupSort ("#groupsRow_'.('n'.$grow_last).'", "'.('n'.$grow_last).'"); }, start: function(e, ui) { groupsSortStart(); }, stop: function(e, ui) { groupsSortStop(); }, over: function(e, ui) { groupsSortOver( e, ui); }, change: function(e, ui) { groupsSortChange( e, ui); }, receive: function(e, ui) { groupsSortReceive( e, ui); } });'.$crlf; 						$AJAX_link_sortables .= '$("#links_g'.$gid_last.'c'.($lcol_last+1).'").sortable({ %%%, update: function(element, ui) { updateLinkSort ("#links_g'.$gid_last.'c'.($lcol_last+1).'", "n'.($lcol_last+1).'", "'.$gid_last.'"); }, start: function(e, ui) { linksSortStart(); }, stop: function(e, ui) { linksSortStop(); } });'.$crlf; 						//-------- BUILD sortables CONNECTIONS						$AJAX_link_sortable_connections .= ', "#links_g'.$gid_last.'c'.($lcol_last+1).'"';						$AJAX_group_sortable_connections .= ', "#groupsRow_'.('n'.$grow_last).'"';					} else if ( $gcol_last != $gcol ) {						echo '				</td><td class="link_col_t" id="links_g'.$gid_last.'c'.($lcol_last+1).'">&nbsp;</td></tr></table></td>'.$crlf;												$AJAX_link_sortables .= '$("#links_g'.$gid_last.'c'.($lcol_last+1).'").sortable({ %%%, update: function(element, ui) { updateLinkSort ("#links_g'.$gid_last.'c'.($lcol_last+1).'", "n'.($lcol_last+1).'", "'.$gid_last.'"); }, start: function(e, ui) { linksSortStart(); }, stop: function(e, ui) { linksSortStop(); } });'.$crlf; 						//-------- BUILD sortables CONNECTIONS						$AJAX_link_sortable_connections .= ', "#links_g'.$gid_last.'c'.($lcol_last+1).'"';					} else if ( $lcol_last != $lcol ) {						echo '				</td>'.$crlf;					}				}								// UL tags inserted with an id based on their group_id and link_col								if ( $grow_last != $grow ) {  // if this is a new group row								//-------- BUILD sortables CALLS				$AJAX_group_sortables .= '$("#groupsRow_'.$res['grow'].'").sortable({ %%%, dropOnEmpty: true, update: function(element, ui) { updateGroupSort ("#groupsRow_'.$res['grow'].'", '.$res['grow'].'); }, start: function(e, ui) { groupsSortStart(); }, stop: function(e, ui) { groupsSortStop(); }, over: function(e, ui) { groupsSortOver( e, ui); }, change: function(e, ui) { groupsSortChange( e, ui); }, receive: function(e, ui) { groupsSortReceive( e, ui); } });'.$crlf; 				$AJAX_link_sortables .= '$("#links_g'.$res['gid'].'c'.$lcol.'").sortable({ %%%, update: function(element, ui) { updateLinkSort ("#links_g'.$res['gid'].'c'.$lcol.'", "'.$lcol.'", "'.$res['gid'].'"); }, start: function(e, ui) { linksSortStart(); }, stop: function(e, ui) { linksSortStop(); } });'.$crlf; //  this and similar commented items are the remains of coding left and right handed new-link columns.  right now the page has only left-handed.//				$AJAX_link_sortables .= '$("#links_g'.$res['gid'].'c'.($lcol-1).'").sortable({ %%%, update: function(element, ui) { updateLinkSort ("#links_g'.$res['gid'].'c'.($lcol-1).'", "'.($lcol-1).'", "'.$res['gid'].'"); }, start: function(e, ui) { linksSortStart(); }, stop: function(e, ui) { linksSortStop(); } });'.$crlf; 								//-------- BUILD sortables CONNECTIONS				$AJAX_link_sortable_connections .= ', "#links_g'.$res['gid'].'c'.$lcol.'"';//				$AJAX_link_sortable_connections .= ', "#links_g'.$res['gid'].'c'.($lcol-1).'"';				$AJAX_group_sortable_connections .= ', "#groupsRow_'.$res['grow'].'"';								$AJAX_link_sortable_updates = 'update: linkUpdate(element, ui, "'.') ")';								$AJAX_group_originals .= "g_orig[".$res['gid']."] = $('#group_".$res['gid']."_name').html();\n";				?>				<table class="group_row"><tr id="groupsRow_<?php echo $res['grow']?>">				<td class="group_block" id="group_<?php echo $res['gid']?>">					<table cellpadding="0" cellspacing="0" width="100%" class="group_title"><tr><td>						<div id="group_<?php echo $res['gid']?>_name"><?php echo $res['GTitle']?> <?php if ($_SESSION['DEBUG']==1) echo $res['gid']?></div>					</td><td align="right"><div class="link_UI_element">						<a class="link-look" onclick="addLink_UI(<?php echo $res['gid']; ?>,'group_<?php echo $res['gid']?>');" style="padding: 0 2px 0 1px; ">+</a> 						<a class="link-look" onclick="updateGroup_UI('<?php echo $res['gid']; ?>','group_<?php echo $res['gid']?>', '<?php echo $res['GTitle']?>');" style="padding: 0 2px 0 1px; ">E</a> 						<a class="link-look" onclick="deleteGroup('<?php echo $res['gid']; ?>');" style=" padding: 0 1px 0 1px; ">X</a>					</div></td></tr></table>					<table class="link_block"><tr><!-- 					<div class="link_col" id="links_g<?php echo $res['gid']?>c<?php echo ($lcol-1)?>"></div> -->					<td class="link_col_t" id="links_g<?php echo $res['gid']?>c<?php echo $lcol?>">					<?php			} else if ( $gcol_last != $gcol ) {  // if this is a new group col				//-------- BUILD sortables CALLS				$AJAX_link_sortables .= '$("#links_g'.$res['gid'].'c'.$lcol.'").sortable({ %%%, update: function(element, ui) { updateLinkSort ("#links_g'.$res['gid'].'c'.$lcol.'", "'.$lcol.'", "'.$res['gid'].'"); }, start: function(e, ui) { linksSortStart(); }, stop: function(e, ui) { linksSortStop(); } });'.$crlf; //				$AJAX_link_sortables .= '$("#links_g'.$res['gid'].'c'.($lcol-1).'").sortable({ %%%, update: function(element, ui) { updateLinkSort ("#links_g'.$res['gid'].'c'.($lcol-1).'", "'.($lcol-1).'", "'.$res['gid'].'"); }, start: function(e, ui) { linksSortStart(); }, stop: function(e, ui) { linksSortStop(); } });'.$crlf; 				//-------- BUILD sortables CONNECTIONS				$AJAX_link_sortable_connections .= ', "#links_g'.$res['gid'].'c'.$lcol.'"';//				$AJAX_link_sortable_connections .= ', "#links_g'.$res['gid'].'c'.($lcol-1).'"';								?>				<td class="group_block" id="group_<?php echo $res['gid']?>">					<table cellpadding="0" cellspacing="0" width="100%" class="group_title"><tr><td>						<div id="group_<?php echo $res['gid']?>_name"><?php echo $res['GTitle']?> <?php if ($_SESSION['DEBUG']==1) echo $res['gid']?></div>					</td><td align="right"><div class="link_UI_element">						<a class="link-look" onclick="addLink_UI(<?php echo $res['gid']; ?>,'group_<?php echo $res['gid']?>');" style="padding: 0 2px 0 1px; ">+</a> 						<a class="link-look" onclick="updateGroup_UI('<?php echo $res['gid']; ?>','group_<?php echo $res['gid']?>', '<?php echo $res['GTitle']?>');" style="padding: 0 2px 0 1px; ">E</a> 						<a class="link-look" onclick="deleteGroup('<?php echo $res['gid']; ?>');" style=" padding: 0 1px 0 1px; ">X</a>					</div></td></tr></table>					<table class="link_block"><tr>					<!-- 					<div class="link_col" id="links_g<?php echo $res['gid']?>c<?php echo ($lcol-1)?>"></div> -->					<td class="link_col_t" id="links_g<?php echo $res['gid']?>c<?php echo $lcol?>">					<?php			} else if ( $lcol_last != $lcol ) { // if this is a new link col				//-------- BUILD sortables CALLS				$AJAX_link_sortables .= '$("#links_g'.$res['gid'].'c'.$lcol.'").sortable({ %%%, update: function(element, ui) { updateLinkSort ("#links_g'.$res['gid'].'c'.$lcol.'", "'.$lcol.'", "'.$res['gid'].'"); }, start: function(e, ui) { linksSortStart(); }, stop: function(e, ui) { linksSortStop(); } });'.$crlf; 				//-------- BUILD sortables CONNECTIONS				$AJAX_link_sortable_connections .= ', "#links_g'.$res['gid'].'c'.$lcol.'"';				// echo $lcol_close; 				?>					<td class="link_col_t" id="links_g<?php echo $res['gid']?>c<?php echo $lcol?>">					<?php			}					if ( $res['URL'] != '' ) {				//	the link row will always change / be new		?>						<div class="link_edit" id="link_<?php echo $res['id']?>">							<div><a href="<?php echo $res['URL']?>" target="_blank"><?php echo $res['title']?></a></div>														<div class="link_UI_element tmenu">								<a class="link-look" style="padding: 0 2px 0 1px; " onclick="updateLink_UI('<?php echo $res['id']; ?>', 'link_<?php echo $res['id']?>', $('html,body').scrollTop() );">E</a> 								<a class="link-look" style=" padding: 0 1px 0 1px; " onclick="deleteLink('<?php echo $res['id']; ?>');">X</a>							</div>						</div><?php			// these IFs allow any wrap-up code, given something new					}				if ( $lcol_last != $lcol ) { ?>				<?php			}				if ( $gcol_last != $gcol ) { ?>				<?php			}				if ( $grow_last != $grow ) { 				?><?php			} //				$errtxt .= '<br />lcol: '.$lcol.' lcol-last: '.$lcol_last.' title: '.$res['title'];							$grow_last = $grow;				$gcol_last = $gcol;				$lcol_last = $lcol;				$gid_last = $res['gid'];				$grow_close = 'dif'.$crlf;				$gcol_close = 'dif'.$crlf;				$lcol_close = '				</td>'.$crlf;			} 			?>			</td>			<td class="link_col_t" id="links_g<?php echo $gid_last ?>c<?php echo ($lcol_last+1) ?>">&nbsp;</td>		</tr></table><?php			$AJAX_link_sortables .= '$("#links_g'.$gid_last.'c'.($lcol_last+1).'").sortable({ %%%, update: function(element, ui) { updateLinkSort ("#links_g'.$gid_last.'c'.($lcol_last+1).'", "n'.($lcol_last+1).'", "'.$gid_last.'"); }, start: function(e, ui) { linksSortStart(); }, stop: function(e, ui) { linksSortStop(); } });'.$crlf; 		//-------- BUILD sortables CONNECTIONS		$AJAX_link_sortable_connections .= ', "#links_g'.$gid_last.'c'.($lcol_last+1).'"';						if ( $sys == 0 ) {			echo '			</td></tr></table><table class="group_row_new" id="groupsRow_'.('n'.$grow_last).'"><tr><td>'.$crlf; 			$AJAX_group_sortables .= '$("#groupsRow_'.('n'.$grow_last).'").sortable({ %%%, dropOnEmpty: true, update: function(element, ui) { updateGroupSort ("#groupsRow_'.('n'.$grow_last).'", "'.('n'.$grow_last).'"); }, start: function(e, ui) { groupsSortStart(); }, stop: function(e, ui) { groupsSortStop(); }, over: function(e, ui) { groupsSortOver( e, ui); }, change: function(e, ui) { groupsSortChange( e, ui); }, receive: function(e, ui) { groupsSortReceive( e, ui); } });'.$crlf; 			$AJAX_group_sortable_connections .= ', "#groupsRow_'.('n'.$grow_last).'"';		}	}?>						</td></tr></table><?php }PrintGroups($result);PrintGroups($resultSys, 1);// here we finalize the connection strings, then insert them into the .sortable calls$AJAX_link_sortable_connections = 'connectWith: ['.substr($AJAX_link_sortable_connections, 2).']'; $AJAX_link_sortables = str_replace("%%%", $AJAX_link_sortable_connections, $AJAX_link_sortables);$arr = explode(",", substr($AJAX_group_sortable_connections, 2));$AJAX_group_sortable_connections = 'connectWith: ['.substr($AJAX_group_sortable_connections, 2).']';	$AJAX_group_sortables = str_replace("%%%", $AJAX_group_sortable_connections, $AJAX_group_sortables);if ( strstr($_SESSION['cur_page'], 'edit') || strstr($_SESSION['cur_page'], 'intro3') ) { ?><script type="text/javascript"><!--var scrollPos = 0;var updateState = 0;var updateStateGroup = 0;var addStateGroup = 0;var execGroupSort = 0;var user_id = <?php echo $_SESSION['user_id'] ?>;var page_id = <?php echo $page_id ?>;var old_f = document.onkeydown;var gg_id = 0;var gTitle = '';// nascent code for loading a UI holder once & first, to avoid scroll issues with dynamic loading (of a .parent=body .append with position:absolute).  perhaps one day this will be used again//	$("body").append('<div id="links_UI_holder"><'+'/div>');//	$("#UI_holder").load( "links_edit_front.php" );//	$("#UI_holder").css( { display: "none" } );g_orig = Array ();<?php 	// lastly, we echo these into place... 		echo $AJAX_link_sortables; 	echo $AJAX_group_sortables; 	echo $AJAX_group_originals;?>/**************** LINK UI ******************/function updateLink_UI( l_id, element, scrd ) {	if ( updateState == 0 ) {			ClearUIs();				scr = getScroll();				$.post("links_edit_front.php", { link_id: l_id },		  function(data){//		  	$(data).appendTo("#"+element);			$(data).prependTo("html");		  	// positioning			var dim = $("#"+element).offset();		  	$("#links_UI").css( { display: "none", top: dim.top, left: dim.left  } );  		  	// ergonomics		  	$("#new_link_form").css( { visibility: "hidden" } );		  	$("#links_UI").show(290, function() { $("#new_link_form").css( { visibility: "visible" } ); });		  	$("#new_link_form").fadeIn();		  							// this is the only procedure that seems to reset the scroll within a proc			$('html,body').animate({scrollTop: scr}, 1);		 }); 		updateState = 1;	} else {		$("#links_UI").fadeOut('fast', function() { $("#links_UI").remove(); });				updateState = 0;	}	}function addLink_UI( group_id, element ) {	if ( updateState == 0 ) {		ClearUIs();		scr = getScroll();				$.post("links_edit_front.php?new=1&group_id="+group_id,		  function(data){		  	$(data).prependTo("#links_groups");		  			  	// positioning			var dim = $("#"+element).offset();		  	$("#links_UI").css( { display: "none", top: dim.top+10, left: dim.left+10 } );		  			  	// ergonomics		  	$("#new_link_form").css( { visibility: "hidden" } );		  	$("#links_UI").show(290, function() { $("#new_link_form").css( { visibility: "visible" } ); });		  	$("#new_link_form").fadeIn();			// this is the only procedure that seems to reset the scroll within a proc			$('html,body').animate({scrollTop: scr}, 1);		 }); 		updateState = 1;	} else {		$("#links_UI").fadeOut('fast', function() { $("#links_UI").remove(); });		updateState = 0;	}}var limit = '1,2';/********************* LINK MANAGEMENT ********************/function updateLinkSort( nameL, col, gid ) {	$('#notify').load('config/links.php?AJAX=1&proc=updateSort&col=' + col + '&page_id=' + page_id + '&group_id=' + gid + '&' + $(nameL).sortable('serialize'), function() { 			refreshContent();	});}function deleteLink( link_id ) {	var b = confirm("Sure you want to delete this link?");	if ( b == true) {		$('#notify').load('config/links.php?AJAX=1&proc=delete&link_id=' + link_id, function() { 			refreshContent();		});			} else {	  // return	}			}/********************* LINK SORTING ********************/function linksSortStart(  ) {//	alert('s');	$(".link_col_t").css({ border:"1px #DAD5B8 solid", margin:"0 2px 0 2px", padding:"0px 2px 0px 2px" });}function linksSortStop(  ) {	$(".link_col_t").css({ border:"none",	margin:"0 3px 0 3px", padding:"1px 2px 1px 2px" });}/********************* GROUP UI ********************/function updateGroup_UI( g_id, element, Title ) {	gg_id = g_id; // set the currently-edited group_id beyond the function (globally)	gTitle = Title;	if ( updateStateGroup == 0 ) {			ClearUIs();		scr = getScroll();		$('#group_'+g_id+'_name').load('DHTML/updateGroups.php?group_id=' + g_id + '&name='+escape(Title));		// this is the only procedure that seems to reset the scroll within a proc		$('html,body').animate({scrollTop: scr}, 1);		updateStateGroup = 1;	} else {		$('#group_'+g_id+'_name').html(Title);		gg_id = 0;				updateStateGroup = 0;	}}	function addGroup_UI(  ) {	if ( addStateGroup == 0 ) {		ClearUIs();		$.post("groups_edit_front.php?new=1",		  function(data){		  	$(data).appendTo("#links_groups");		  			  	// positioning			var dim = $("#links_groups").offset();		  	$("#groups_UI").css( { display: "none", top: dim.top+10, left: dim.left+10 } );		  			  	// ergonomics		  	$("#new_group_form").css( { visibility: "hidden" } );		  	$("#groups_UI").show(290, function() { $("#new_group_form").css( { visibility: "visible" } ); });		  	$("#new_group_form").fadeIn();		 }); 		addStateGroup = 1;	} else {		$("#groups_UI").fadeOut('fast', function() { $("#groups_UI").remove(); });		addStateGroup = 0;	}}/********************* GROUP MANAGEMENT ********************/function deleteGroup( g_id ) {	var b = confirm("Sure you want to delete this group?\nAll its links will go, too!");	if ( b == true) {		$('#notify').load('config/groups.php?AJAX=1&proc=delete&user_id='+user_id+'&page_id='+page_id+'&group_id=' + g_id, function() { 			refreshContent();		});			} else {	  // return	}			}		function updateGroupSort( nameL, grow ) {	$('#notify').load('config/groups.php?AJAX=1&proc=updateSort&grow=' + grow + '&' + $(nameL).sortable('serialize'), function() { 			refreshContent();	});}function NEW_updateGroupSort( nameL, grow ) {	// add the groupsort data to a queue	$('#notify').load('config/groups.php?AJAX=1&proc=updateSort&grow=' + grow + '&' + $(nameL).sortable('serialize'), function() { 			refreshContent();	});	if ( execGroupSort == 0) {		}}/********************* GROUP SORTING ********************/function groupsSortStart(  ) {	$(".group_row").css({ border:"1px #ccc solid" });	$(".group_row_new").css({ minHeight: "8px", margin: "1px 0 1px 0", border:"1px #ccc solid" });/*	$(".group_row").hover( function() { 		$(this).css({ border:"1px #000 solid" });	}, function() {		$(this).css({ border:"none" });	});*/}function groupsSortStop(  ) {	$(".group_row").css({ border:"none" });	$(".group_row_new").css({ minHeight: "8px", margin: "1px 0 1px 0", border:"1px #fff solid" });		$(".group_row").hover( function() { });}function groupsSortChange( e, ui ) {	}function groupsSortReceive( e, ui ) {}function groupsSortOver( e, ui ) {//  mad event print debugging::/*//	alert (e.target.id);	for (x in e.toElement.parentElement) $('#notify_d_this_page_errtxt').html( $('#notify_d_this_page_errtxt').html() + '<br/>'+ x + ':' + e.toElement.offsetParent[x] );//	$('#notify_d_this_page_errtxt').html( $('#notify_d_this_page_errtxt').html() + '<br/>'+ e.target.id );	//	$("#"+ui.item[0].id).css({ border:"1px #777 solid" });	$('#notify_d_this_page_errtxt').html( $('#notify_d_this_page_errtxt').html() + '<br/>' );*/}/********************* UTILITIES ********************/function outputarray(element, index, array) {	$('#notify_d_this_page_errtxt').text( $('#notify_d_this_page_errtxt').text() +  "Element "+index+" contains the value "+element+"\n" );}function refreshContent() {	$('#links_groups').load('groups_block_list.php');			$('#links_flat_list').load('links_flat_list.php');	$('#notify_d_last_page_errtxt').load('config/almanac.php?uid=<?php echo $_SESSION["user_id"]?>&limit=' + limit + '&AJAX=1');}			function combinedGroupSort() {	// future home of the procedure to record sort updates for a(n external) batch update process	execGroupSort = 0;}			function scrollTo( scrf ) {//	alert(scrf);	$("html,body").scrollTop( scrf );}function ClearUIs () {	if ( updateState == 1 ) {	// link UI		updateLink_UI();		updateState = 0;	}	if ( updateStateGroup == 1 ) {	// edit group name UI		$('#group_'+gg_id+'_name').html(gTitle);		updateStateGroup = 0;	}	if ( addStateGroup == 1 ) {		// add group UI		addGroup_UI();		addStateGroup = 0;	}}function getScroll () {	if ( window.pageYOffset > $("html,body").scrollTop() ) {		return window.pageYOffset;	} else {		return $("html,body").scrollTop() ;	}}/********************* KEY CONTROL ********************/$(document).keydown( function( e ) { 	switch (e.which) { 	case 27: // escape		ClearUIs();		document.onkeydown = old_f;		break;//	case 13: // enter	default:		// 	}});/********************* PERSISTANT ********************/$(document).ready(function(){	//menuYloc = parseInt( $('#content_floater_edit').css("top").substring( 0, $(name).css("top").indexOf("px") ) );	menuYloc = $("#content_floater_edit").offset().top ;	menuXloc = $("#frame_banner").offset().left ;		$(window).scroll(function(){//		var offset = $(window).height() - $('#content_floater_edit').height() - 30 + getScroll();		var offset = initCFEpos + getScroll();		$('#content_floater_edit').animate( { top:offset }, { duration:300, queue:false });	});});//var initCFEpos = $(window).height() - $('#content_floater_edit').height() - 30;var initCFEpos = $('#content_floater_edit').position().top ;$('#content_floater_edit').css( { position: 'absolute', top: initCFEpos } );//--></script><?php}	if ( ($_SESSION['DEBUG']=='1') and ( strstr($_SESSION['cur_page'], 'edit') ) ) { ?>	<script type="text/javascript"><!--	$('#notify_d_page_id').text("<?php echo $page_id;?> (from groups_block_list)");	$('#notify_d_this_page_errtxt').html( $('#notify_d_this_page_errtxt').html() +  "<?php echo $errtxt;?>" + "<br /><?php echo $page_id;?> (from groups_block_list)" );//--></script><?php	}?></div>