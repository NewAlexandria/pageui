<?phpsession_start();require_once('config/keys.php');require_once('config/db.php');	/// User logins should be validated against a system login table, and the table should include a variable specific to the login cookie data: either a browser-generated cookie ID, or a seeded rand() saved as cookie var.  If it were hashed against the user password hash then its closer to a cryptographic login validation// setup the ORDER sufix to sort the SQL rowset.// setup, also, display vars and other user-controls (  $group_inv = '';  $URL_inv = '';  $link_inv = '';  $date_inv = '';  /// in the future we may get these from the $_SESSION.  Do huge sessions make for a slow connection??if ( ($_REQUEST['links_flat_list_sort']) or ( $_SESSION['links_flat_list_sort']) ) {		// set session variables to maintain the view	if ( $_REQUEST['links_flat_list_sort'] ) $_SESSION['links_flat_list_sort'] = $_REQUEST['links_flat_list_sort'];	if ( $_REQUEST['inv'] ) $_SESSION['inv'] = $_REQUEST['inv'];	$links_flat_list_sort = $_SESSION['links_flat_list_sort'];	$inv = $_SESSION['inv'];		switch ( $links_flat_list_sort )	{	    case "group":	        $order = ' ORDER BY G.Title ASC, G.row, G.col, L.col, L.row';	        if ( $inv == '1' ) {	        	$order = ' ORDER BY G.Title DESC, G.row, G.col, L.col, L.row';	        } else {	        	$group_inv = '&inv=1';	        }	        			$group_hl = ' class="sort-highlight"';	        break;	    case "date":	        $order = ' ORDER BY L.date_add';	        if ( $inv ) {	        	$order .= ' DESC';	        } else {	        	$date_inv = '&inv=1';	        }	        			$date_hl = ' class="sort-highlight"';	        break;	    case "title":	        $order = ' ORDER BY L.title';	        if ( $inv ) {	        	$order .= ' DESC';	        } else {	        	$link_inv = '&inv=1';	        }	        			$link_hl = ' class="sort-highlight"';	        break;	    case "URL":	        $order = ' ORDER BY L.URL';	        if ( $inv ) {	        	$order .= ' DESC';	        } else {	        	$URL_inv = '&inv=1';	        }	        			$URL_hl = ' class="sort-highlight"';	        break;	    default:	        $order = ' ORDER BY L.group_id, G.row, G.col, L.col, L.row';	        break;	}	} $sql = "SELECT G.Title AS GTitle, G.row as grow, G.col as gcol, G.id as gid, L.* FROM Links as L INNER JOIN Groups G ON L.group_id = G.id INNER JOIN Pages P ON L.page_id = P.id INNER JOIN GroupsPages as GP ON L.group_id = G.id WHERE (L.user_id = GP.user_id AND L.group_id = GP.group_id AND L.page_id = GP.page_id ) AND GP.user_id = ".$_SESSION['user_id']." AND GP.page_id = ".$_COOKIE['page_id'].$order;// echo $sql;$result = mysql_query($sql);$errtxt .= '<br/>'.$sql;$errtxt .= '<br/>sql error: '.mysql_error($db).''; $errtxt .= '<br/>rows: '.mysql_num_rows($result).'<br/>'; // this is buit for the links tha re-organize the list of links$sort_url = $site_uri.substr($_SERVER['SCRIPT_NAME'], 1);// $_SERVER['SCRIPT_NAME']?>			<table style="width: 100%"><?php 		if (mysql_num_rows($result)>0) { ?>			<tr class="header-group">				<td<?php echo $group_hl?>><a href="<?php echo $sort_url?>?links_flat_list_sort=group<?php echo $group_inv?>">Group</a></td>								<td<?php echo $URL_hl?>><a href="<?php echo $sort_url?>?links_flat_list_sort=URL<?php echo $URL_inv?>">URL</a></td>								<td<?php echo $link_hl?>><a href="<?php echo $sort_url?>?links_flat_list_sort=title<?php echo $link_inv?>">Link</a></td>								<td<?php echo $date_hl?>><a href="<?php echo $sort_url?>?links_flat_list_sort=date<?php echo $date_inv?>">date created</a></td>			</tr><?php		while ( $res = mysql_fetch_assoc($result) ) { 			if ( strlen($res['URL']) > 77 ) {				$URL_trunc = substr($res['URL'], 0, 77)."...";			} else {				$URL_trunc = $res['URL'];			} 			$edit_link = $site_uri.$site_path.'edit.php?link_id='.$res['id']; 						?>			<tr>							<td><a href="<?php echo $edit_link?>"><?php echo $res['GTitle'] ?></a></td>				<td style="max-height: 10px; overflow: hidden;" ><a href="<?php echo $res['URL']?>" target="_blank"><?php echo $URL_trunc; ?></a></td>				<td><a href="<?php echo $res['URL']?>" target="_blank"><?php echo $res['title']?></a></td>				<td><?php echo date('m/d/Y', strtotime($res['date_add']) )?></td>			</tr><?php		}		}	?>			</table><?php	if ( ($_SESSION['DEBUG']=='1') and ( strstr($_SESSION['cur_page'], 'edit') ) ) { ?>	<script type="text/javascript"><!--	$('#notify_d_page_id').text("<?php echo $_COOKIE['page_id'];?> (from links_flat_list)");	$('#notify_d_this_page_errtxt').html( $('#notify_d_this_page_errtxt').html() +  "<?php echo $errtxt;?>" + "<br /><?php echo $_COOKIE['page_id'];?> (from links_flat_list)");//--></script><?php	}?>