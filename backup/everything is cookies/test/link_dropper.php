<?phpsession_start();include('config/keys.php');require('config/db.php');// screen for whether they are logged inif ($_SESSION['user_id']=="") {	if ($_COOKIE['maintain'] != "") {		header("Location: config/login.php?x=login&user_id=".$_COOKIE['maintain']);	} else {		header("Location: ".$home);			exit;	}}?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" id="dropper_doc"><head>	<title>Add this link to your PageUI</title>	<meta name="generator" content="BBEdit 9.0" />	<link rel="stylesheet" rev="stylesheet" href="beta.css" /></head><body onload="document.new_link_form.title.focus();document.new_link_form.title.select();" id="dropper_body" style="background-color: #eee; border: 3px #999 double;" onunload="closeFrameInner(document.getElementById('new_link_form'));" ><!-- <script type="text/javascript" src="http://127.0.0.1/~equinox/pageui/link_dropper.js"/> --><script type="text/javascript">// <![CDATA[	function submitenter(myfield,e)	{	var keycode;	if (window.event) keycode = window.event.keyCode;	else if (e) keycode = e.which;	else return true;			if (keycode == 13)	{		get(document.getElementById('new_link_form'));//		myfield.submit();//		self.focus();//		window.close();						return false;	}		else		return true;	}    function timedFadeOut(element){      opacity = 100;      timer = setTimeout("triggerFadeOut('"+element+"', "+opacity+")", 	5);    }    function triggerFadeOut(element, this_opacity){      if(this_opacity >= .0){        setOpacity(element, this_opacity);        timedFade(element);        opacity -= 0.01;      }else{        clearTimeout(timer);      }    }	      function closeFrameInner(bis){//      	alert(bis.id);      	myfield = document.getElementById('new_link_form'); //      	myfield.submit();//		timedFadeOut(bis);      	      	document.body.setAttribute('style', 'background-color:none;');      	myfield.parentNode.parentNode.parentNode.removeChild(myfield.parentNode.parentNode);      	      		}		   var http_request = false;   function makeRequest(url, parameters) {      http_request = false;      if (window.XMLHttpRequest) { // Mozilla, Safari,...         http_request = new XMLHttpRequest();         if (http_request.overrideMimeType) {         	// set type accordingly to anticipated content type            //http_request.overrideMimeType('text/xml');            http_request.overrideMimeType('text/html');         }      } else if (window.ActiveXObject) { // IE         try {            http_request = new ActiveXObject("Msxml2.XMLHTTP");         } catch (e) {            try {               http_request = new ActiveXObject("Microsoft.XMLHTTP");            } catch (e) {}         }      }      if (!http_request) {         alert('Cannot create XMLHTTP instance');         return false;      }      http_request.onreadystatechange = alertContents;      http_request.open('POST', url + parameters, true);      http_request.send(null);   }   function alertContents() {      if (http_request.readyState == 4) {         if (http_request.status == 200) {            //alert(http_request.responseText);            result = http_request.responseText;            document.getElementById('dropper_body').innerHTML = result;                closeFrameInner(document.getElementById('new_link_form'));            window.close;         } else {            alert('There was a problem with the request.');         }      }   }   	function get(obj) {	  var getstr = "?";	  for (i=0; i<obj.getElementsByTagName("input").length; i++) {			if (obj.getElementsByTagName("input")[i].type == "text") {			   getstr += obj.getElementsByTagName("input")[i].name + "=" + 					   escape(obj.getElementsByTagName("input")[i].value) + "&";			}			if (obj.getElementsByTagName("input")[i].type == "hidden") {			   getstr += obj.getElementsByTagName("input")[i].name + "=" + 					   escape(obj.getElementsByTagName("input")[i].value) + "&";			}			if (obj.getElementsByTagName("input")[i].type == "checkbox") {			   if (obj.getElementsByTagName("input")[i].checked) {				  getstr += obj.getElementsByTagName("input")[i].name + "=" + 					   escape(obj.getElementsByTagName("input")[i].value) + "&";			   } else {				  getstr += obj.getElementsByTagName("input")[i].name + "=&";			   }			}			if (obj.getElementsByTagName("input")[i].type == "radio") {			   if (obj.getElementsByTagName("input")[i].checked) {				  getstr += obj.getElementsByTagName("input")[i].name + "=" + 					   escape(obj.getElementsByTagName("input")[i].value) + "&";			   }		 }  		 if (obj.getElementsByTagName("select")[i] ) {			var sel = obj.getElementsByTagName("select")[i];			getstr += sel.name + "=" + escape(sel.options[sel.selectedIndex].value) + "&";		 }		 	  }	  makeRequest('config/links.php', getstr);	}	// ]]></script><?php	$target_group = '1';	$URL = $_REQUEST['URL'];	$title = $_REQUEST['title'];	?><h3 style="margin: 20px 0 0 10px;">Add to PageUI</h3><img src="http://www.pageui.com/images/x-t.png" alt="close" title="close" id="close_button" style="position:fixed; top:20px; right:0px; z-index:10000001; margin:3px 30px 0 0; font-size:9px; border:1px solid #9EB847; padding:0; background:0; height:15px; width:15px" onclick="closeFrameInner(document.getElementById('new_link_form'));" />      	  	<div id="dropper_main">			<form action="javascript:get(document.getElementById('new_link_form'));" method="post" id="new_link_form" name="new_link_form" onkeypress="return submitenter(this,event)" ><!-- onsubmit="closeFrameInner(document.getElementById('new_link_form'));window.close;" --> 			<table border="0" cellpadding="2">				<tr>					<td>Link / URL: </td>					<td><input name="URL" id="URL" type="text" size="40" maxlength="255" tabindex="1" value="<?php echo $URL ?>" /></td>				</tr>				<tr>					<td>Title: </td>					<td><input name="title" id="title" type="text" size="40" maxlength="45" tabindex="2" value="<?php echo $title ?>" /></td>					<td></td>				</tr>				</table>				<table>				<tr>					<td>Group: </td>					<td><select id="group_id" tabindex="3" name="group_id">						<!-- /// on elect of this option, hide new_link_form.new_group -->						<option label="add to a new group: " value="/new/" selected>add to a new group: </option>						<?php $sql = "SELECT G.id AS id, G.Title AS Title FROM Groups G INNER JOIN GroupsPages GP ON G.id = GP.group_id INNER JOIN Links L ON GP.group_id = L.group_id WHERE L.user_id = GP.user_id AND L.user_id = ".$_SESSION['user_id']." AND GroupType_id < 2 GROUP BY G.Title";							$errtxt .= '<br />'.$sql;							$resG = mysql_query($sql);							if (mysql_num_rows($resG)>0) {								echo '					<optgroup label="Your Groups">';								while ($r = mysql_fetch_assoc($resG)) { 																// determine whether to draw ' selected' label								if ( $r['id'] == $target_group)  {									$sel = ' selected';								} else {									$sel = '';								}								?>						<option label="<?php echo $r['Title'] ?>" value="<?php echo $r['id']?>" <?php echo $sel?>><?php echo $r['Title']?></option>							<?php 	} ?>						</optgroup>					<?php								}													?>						<optgroup label="System Groups">						<?php $sql = "SELECT G.id AS id, G.Title AS Title FROM Groups G WHERE GroupType_id = 2 ORDER BY G.Title";							$errtxt .= $sql;							$resG = mysql_query($sql);							while ($r = mysql_fetch_assoc($resG)) {								// determine whether to draw ' selected' label								if ( $r['id'] == $target_group)  {									$sel = ' selected';								} else {									$sel = '';								}							?>							<option label="<?php echo $r['Title']?>" value="<?php echo $r['id'] ?>" <?php echo $sel?>><?php echo $r['Title']?></option>	<?php							}						?>						</optgroup>					</select>					</td>					<td>						<input name="new_group" id="new_group" type="text" size="20" maxlength="30" tabindex="6" />					</td>					</tr><tr>					<td><input name="submit" type="submit" value="Add" onclick="return submitenter(this,event)" /></td>				</tr>			</table>						<input name="row" id="row" type="hidden" size="2" maxlength="2" tabindex="4" value="<?php echo $row ?>" />			<input name="col" id="col" type="hidden" size="2" maxlength="2" tabindex="5" value="<?php echo $col ?>" />						<input name="proc" type="hidden" value="add" />			<input name="page" type="hidden" value="../link_dropper.php" />		</form>		</div></body></html>