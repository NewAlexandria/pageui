<?php 	session_start();	if (!$db) {	require_once('config/keys.php');	require_once('config/db.php');}// pseudo-checks the loading of $resPagesif (! $resPages) {	$sqlPages = "SELECT P.* FROM Pages P INNER JOIN UsersPages UP ON P.id = UP.page_id WHERE UP.user_id = ".$_SESSION['user_id']." ORDER BY UP.sort ASC";	$resPages = mysql_query($sqlPages);		$errtxt .= '<br/>'.$sql; 	$errtxt .= '<br/>rows (p): '.mysql_num_rows($resPages).'<br/>'; } if ( stripos( $_SERVER["REQUEST_URI"], 'edit' ) == 0 ) {	$page = 'home.php';} else {	$page = 'edit.php';}?>	<div class="pages">	<hr size="0.5" />	<ul id="pages_list" style="list-style-type:none; cursor: pointer;">	<?php		$AJAX_originals = '';		if (mysql_num_rows($resPages)>0) {			while ($r = mysql_fetch_assoc($resPages)) { 						// building JS variables.  these will be echo'd in later at the in-page javascript block			$AJAX_originals .= "temp[".$r['id']."] = $('#page_name_".$r['id']."').html();\n";						// determine whether to draw ' selected' label			if ( $r['id'] == $_COOKIE['page_id'])  {				$sel = 'menu_element_active';			} else {				$sel = 'menu_element';			}			?>		<li class="<?php echo $sel;?>" id="page_<?php echo $r['id']; ?>" onmouseover="" >			<table style="width: 100%; height: 10px;" cellpadding="0" cellspacing="0" ><tr>			<td id="page_name_<?php echo $r['id']; ?>" style=" max-height: 10px;">				<a href="<?php echo $site_uri.$site_path.$page; ?>?s_page_id=<?php echo $r['id']?>" style="margin-left: 3px"><?php echo $r['Name']?></a>			</td><?php // only drop in this editing code if we're looking at edit.php			if ( strstr($_SESSION['cur_page'], 'edit') or ( $_REQUEST['mode'] == 'edit') ) { ?>				<td style="text-align: right;" valign="top"><div >				<a href="javascript:updatePage_UI('<?php echo $r['id']; ?>','<?php echo $r['Name']?>');" style="display:inline-block; padding: 0 2px 0 1px; ">E</a> 				<a href="javascript:deletePage('<?php echo $r['id']; ?>');" style="display:inline-block; padding: 0 1px 0 1px; ">X</a></div>				</td><?php		}  ?>			</tr></table>		</li>			<?php 	}		} ?>		</ul></div><?php if ( strstr($_SESSION['cur_page'], 'edit') ) { ?><script type="text/javascript"><!--	// we need to to know the state of the UI: are they looking at an page_name update form already?	var updateStatePages = 0;		// this is the array of innerHTML values so that we can switch back on a no-edit without reloading	temp = Array ();	<?php echo $AJAX_originals; ?>		//	$('#notify').text(temp[1]); // a debug line		function deletePage( page_id ) {		var b = confirm("This will delete the page\n\nYou will no longer be able to access \nthe links stored here.\n");		if ( b == true) {			$('#notify').load('config/pages.php?AJAX=1&proc=delete&page_id=' + page_id, function() { 				$('#frame_pages_include').load('pages.php?mode=edit'); 			// reload the groups views//			$('#links_groups').load('links_add_front.php');			//			$('#links_groups').append( document.createTextNode("Hello") );			$('#links_groups').load('groups_block_list.php');			$('#links_flat_list').load('links_flat_list.php');			});							} else {		  // return		}					}		function updatePage_UI( page_id, page_name ) {		if ( updateStatePages == 0 ) {			$('#page_name_'+page_id).load('DHTML/updatePages.php?page_id=' + page_id + '&name='+escape(page_name));//			$('#pages_name').focus();			updateStatePages = 1;		} else {			$('#page_name_'+page_id).html(temp[page_id]);			updateStatePages = 0;		}	}		function updatePageSort (nameE) { //			$('#notify').text( $('#pages_list').sortable('serialize') );						$('#notify').load('config/pages.php?AJAX=1&proc=updateOrder&' + $(nameE).sortable('serialize') );			//			$.post("config/pages.php", { AJAX: '1', page: $('#pages_list').sortable('serialize'), proc: 'updateOrder', page: 'edit.php' } ); 		}		$("#pages_list").sortable({//		connectWith: ["#col1", "#col3"], 		update:  function(element, ui) {			updatePageSort ('#pages_list');		}	});//--></script><?php }  ?>