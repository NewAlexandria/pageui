<?php 	session_start();	if (!$db) {	require_once('config/keys.php');	require_once('config/db.php');}// pseudo-checks the loading of $resPagesif (! $resPages) {	$sqlPages = "SELECT P.* FROM Pages P INNER JOIN UsersPages UP ON P.id = UP.page_id WHERE UP.user_id = ".$_SESSION['user_id']." ORDER BY UP.sort ASC";	$resPages = mysql_query($sqlPages);		$errtxt .= '<br/>'.$sql; 	$errtxt .= '<br/>rows (p): '.mysql_num_rows($resPages).'<br/>'; } // sets page in _Sessionif ( $_REQUEST['s_page_id'] ) $_SESSION['page_id'] = $_REQUEST['s_page_id'];	if ( stripos( $_SERVER["REQUEST_URI"], 'edit' ) == 0 ) {	$page = 'home.php';} else {	$page = 'edit.php';}?>	<div class="pages">	<hr size="0.5" />	<div id="pages_list">	<?php		$AJAX_originals = '';		if (mysql_num_rows($resPages)>0) {			while ($r = mysql_fetch_assoc($resPages)) { 						// building JS variables.  these will be echo'd in later at the in-page javascript block			$AJAX_originals .= "temp[".$r['id']."] = $('#page_name_".$r['id']."').html();\n";						// determine whether to draw ' selected' label			if ( $r['id'] == $_SESSION['page_id'])  {				$sel = 'menu_element_active';			} else {				$sel = 'menu_element';			}			?>		<div class="page <?php echo $sel;?>" id="page_<?php echo $r['id']; ?>">			<table style="width: 100%; height: 10px;" cellpadding="0" cellspacing="0" ><tr>			<td id="page_name_<?php echo $r['id']; ?>" style="height: 10px;">				<div style="width: 100%"><a href="<?php echo $site_uri.$site_path.$page; ?>?s_page_id=<?php echo $r['id']?>" style="margin-left: 3px"><?php echo $r['Name']?></a></div><?php // only drop in this editing code if we're looking at edit.php			if ( strstr($_SESSION['cur_page'], 'edit')or ( $_REQUEST['mode'] == 'edit') ) { 				$AJAX_pos .= "$('#edit_".$r['id']."').css( { position: 'absolute', top: ( $('#page_".$r['id']."').offset().top + 2) + 'px', left: ( $('#page_".$r['id']."').offset().left + $('#page_".$r['id']."').width() - $('#edit_".$r['id']."').width() ) + 'px' } );" . "\r\n";				?>				<div class="link_UI_element pmenu" id="edit_<?php echo $r['id']; ?>">				<a href="javascript:updatePage_UI('<?php echo $r['id']; ?>','<?php echo $r['Name']?>');" style="display:inline-block; padding: 0 2px 0 1px; ">E</a> 				<a href="javascript:deletePage('<?php echo $r['id']; ?>');" style="display:inline-block; padding: 0 1px 0 1px; ">X</a></div><?php		}  ?>				</td>			</tr></table>		</div>			<?php 	}		} ?>		</div></div><?php if ( strstr($_SESSION['cur_page'], 'edit') ) { ?><script type="text/javascript"><!--	// we need to to know the state of the UI: are they looking at an page_name update form already?	var updateStatePages = 0;		// this is the array of innerHTML values so that we can switch back on a no-edit without reloading	temp = Array ();	<?php echo $AJAX_originals ?>		//	$('#notify').text(temp[1]); // a debug linevar edit_page_name = '';var edit_page_id = '';		function deletePage( page_id ) {		var b = confirm("This will delete the page\n\nYou will no longer be able to access \nthe links stored here.\n");		if ( b == true) {			$('#notify').load('config/pages.php?AJAX=1&proc=delete&page_id=' + page_id, function() { 				$('#frame_pages_include').load('pages.php?mode=edit'); 				refreshContent();			});							} else {		  // return		}					}	function updatePage_UI( page_id, page_name ) {		if ( updateStatePages == 0 ) {			updateStatePages = 1;			$('#page_name_'+page_id).load('DHTML/updatePages.php?edit_page_id=' + page_id + '&edit_name='+escape(page_name));			$("#pages_list").sortable( 'disable' );//			$('#pages_name').focus();		} else {			$("#pages_list").sortable( 'enable' );			updateStatePages = 0;//			$('#page_name_'+page_id).html(temp[page_id]);			$('#frame_pages_include').load('pages.php?mode=edit'); 			refreshContent();		}	}		function updatePageSort (nameE) { 		$('#notify').load('config/pages.php?AJAX=1&proc=updateOrder&' + $(nameE).sortable('serialize') );				}		$("#pages_list").sortable({		update:  function(element, ui) {			updatePageSort ('#pages_list');		}	});	  	function updatePage( page_id ) {		var getstr;		getstr = $("#update_page_form input").serialize() ;//		getstr = $("#update_page_form > :input[type != submit]").map(function(){//			return $(this).attr("name") + "=" + $(this).val();//		}).get().join("&") ;		//		alert('config/pages.php?AJAX=1&page_id=' + page_id + 'name=' + $('#pages_name').val() + '&' + getstr);//		alert ( $("#update_page_form #pages_name").val() );//		$('#notify').text( 'config/pages.php?AJAX=1&' + getstr ) ;						$('#notify').load('config/pages.php?h=2&AJAX=1&' + getstr, {limit: 25}, function() { //			updateStatePages = 0;			updatePage_UI('<?php echo $_REQUEST["edit_page_id"]; ?>', $("#update_page_form #pages_name").val() );		});    }    // position_page_ui();<?php // echo $AJAX_pos; ?>//--></script><?php }  ?>