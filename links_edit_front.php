<?phpsession_start ( );require_once('config/keys.php');require_once('config/db.php');	$target_group = '0';if ( $_REQUEST['link_id'] != '' ) {	$sql = "SELECT * FROM Links WHERE id = ".ReturnSecureString($_REQUEST['link_id']);	$errtxt .= '<br />'.$sql;	$rL = mysql_query($sql);	if ( mysql_num_rows($rL)>0 ) {		$resL = mysql_fetch_assoc($rL);			$link_id = $resL['id'];		$target_group = $resL['group_id'];		$errtxt .= '<br/>target: '.$target_group;		$URL = $resL['URL'];		$title = $resL['title'];		$row = $resL['row'];		$col = $resL['col'];	} else {		$link_id = $_REQUEST['id'];		$target_group = $_REQUEST['group_id'];		$URL = $_REQUEST['URL'];		$title = $_REQUEST['title'];		$row = $_REQUEST['row'];		$col = $_REQUEST['col'];	}// else look for a group_id passed in} else if ( $_REQUEST['group_id'] ) {	$target_group = $_REQUEST['group_id'];// else there is no group, set it to unsorted} else {	/// CONFIG the group_id is hard-coded here	$target_group = '1';}if ( $_REQUEST['new'] == '1' ) {	$submit_title = "Add";//	$js_focus = '$("#URL").focus();';	$proc_to = 'add';	$x_button_href = "javascript:updateLink_UI('".$resL['id']."', 'link_".$resL['id']."');";} else {	$submit_title = "Update";	$js_focus = '$("#URL").focus();';	$proc_to = 'update';	$x_button_href = "javascript:deleteLink('".$resL['id']."');";}?><div id="links_UI">	<form action="javascript:updateLink();" method="post" id="new_link_form" name="new_link_form">		<table border="0" cellpadding="2">			<tr>				<td>Link: </td>				<td><input name="URL" id="URL" type="text" size="30" maxlength="255" tabindex="1" value="<?php echo $URL ?>" /></td>								<td>					<div class="link_UI_element"><?php if ( $_REQUEST['new'] != '1' ) { ?>						<a href="javascript:updateLink_UI('<?php echo $resL['id']; ?>', 'link_<?php echo $resL['id']?>');" style="padding: 0 2px 0 1px; ">E</a> <?php } ?>						<a href="<?php echo $x_button_href ?>" style=" padding: 0 1px 0 1px; ">X</a>					</div>				</td>			</tr>			<tr>				<td>Title: </td>				<td><input name="title" id="title" type="text" size="30" maxlength="45" tabindex="2" value="<?php echo $title ?>" /></td>				<td><input name="submit" type="submit" value="<?php echo $submit_title ?>" /></td>			</tr><?php 	// if this is a new link to be added then we will show fields necessary to select group		if ( $_REQUEST['new'] == 1 and !$_REQUEST['group_id'] ) { ?>						<tr>				<td>Group: </td>				<td><select id="group_id" tabindex="3" name="group_id">					<!-- /// on elect of this option, hide new_link_form.new_group -->					<option label="add to a new group: " value="/new/">add to a new group: </option>					<?php $sql = "SELECT G.id AS id, G.Title AS Title FROM Groups G INNER JOIN GroupsPages as GP ON GP.group_id = G.id WHERE GP.page_id = ".$_SESSION['page_id']." AND GP.user_id = ".$_SESSION['user_id']." AND GroupType_id < 2 GROUP BY G.Title";						$errtxt .= '<br />'.$sql;						$resG = mysql_query($sql);						if (mysql_num_rows($resG)>0) {							echo '					<optgroup label="Your Groups">';							while ($r = mysql_fetch_assoc($resG)) { 														// determine whether to draw ' selected' label							if ( $r['id'] == $target_group)  {								$sel = ' selected';							} else {								$sel = '';							}							?>					<option label="<?php echo $r['Title'] ?>" value="<?php echo $r['id']?>" <?php echo $sel?>><?php echo $r['Title']?></option>						<?php 	} ?>					</optgroup>					<?php							}											?>					<optgroup label="System Groups">					<?php $sql = "SELECT G.id AS id, G.Title AS Title FROM Groups G WHERE GroupType_id = 2 ORDER BY G.Title";						$errtxt .= '<br />'.$sql;						$resG = mysql_query($sql);						while ($r = mysql_fetch_assoc($resG)) {							// determine whether to draw ' selected' label							if ( $r['id'] == $target_group)  {								$sel = ' selected';							} else {								$sel = '';							}						?>						<option label="<?php echo $r['Title']?>" value="<?php echo $r['id'] ?>" <?php echo $sel?>><?php echo $r['Title']?></option>					<?php						}					?>					</optgroup>				</select>				</td>			</tr>			<tr>				<td></td>				<td>					<input name="new_group" id="new_group" type="text" size="20" maxlength="30" tabindex="6" />				</td>			</tr>			<?php 	} else {	?>		<input name="group_id" id="group_id" type="hidden" value="<?php echo $target_group ?>" /><?php 	}	?>		</table>				<input name="row" id="row" type="hidden" value="<?php echo $row ?>" />		<input name="col" id="col" type="hidden" value="<?php echo $col ?>" />				<input name="AJAX" type="hidden" value="1" />		<input name="link_id" type="hidden" value="<?php echo $link_id?>" />		<input name="page_id" type="hidden" value="<?php echo $_SESSION['page_id'] ?>" />		<input name="proc" type="hidden" value="<?php echo $proc_to ?>" />	</form>	<script type="text/javascript"><!--	function updateLink() {		var getstr;		getstr = $("#new_link_form *").serialize() ;		$('#notify').load('config/links.php?' + getstr, function() { 			updateLink_UI_Clear();			refreshContent();		});	}	$("#new_group").css( { display: "none" } );	$("#group_id").change(function () {          var str = "";          if ( $("#group_id option:selected").val() == '/new/') {                $("#new_group").slideDown(150);              } else {              	$("#new_group").slideUp(150);              }        })        .change();		$("*", document.body).keypress(function(e){		if(e.keyCode==27){			$("#links_UI").remove();		  } else if (e.keyCode == 13) {			$("#new_link_form").submit();		  }		});	<?php echo $js_focus; ?>		$("#new_link_form").blur(function() { 		$("#links_UI").fadeOut('fast', function() { 			$("#links_UI").remove(); 		}); 	});				$('#notify_d_this_page_errtxt').html( $('#notify_d_this_page_errtxt').html() +  "<?php echo $errtxt;?>" + "<br /><?php echo $_REQUEST['link_id'];?> (from links_edit_front)" );//--></script></div>